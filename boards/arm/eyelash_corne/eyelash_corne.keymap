#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/mouse.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/rgb.h>

/ {
    behaviors {
        td0: td0 {
            compatible = "zmk,behavior-tap-dance";
            #binding-cells = <0>;
            bindings = <&kp LEFT_SHIFT>, <&kp CAPS>;
        };

        llock_1: layer_lock {
          compatible = "zmk,behavior-sticky-key";
          label = "Layer Lock";
          bindings = <&mo 1>;
          flavor = "lock";
        };
    };

    rgb_encoder: rgb_encoder {
        compatible = "zmk,behavior-sensor-rotate";
        #sensor-binding-cells = <0>;
        bindings = <&rgb_ug RGB_BRI>, <&rgb_ug RGB_BRD>;
    };

    keymap {
        compatible = "zmk,keymap";



  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //  L0: BAS - Base Layer
  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        default_layer {
            display-name = "BAS";
            bindings = <
/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                                                    +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   | L: HOMEROW (def)   | Q                  | W                  | E                  | R                  | T                  |                                                    | UP                 |                             | Y                  | U                  | I                  | O                  | P                  | L: APP             |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                                                    +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &none                &kp Q                &kp W                &kp E                &kp R                &kp T                                                                     &kp UP                                             &kp Y                &kp U                &kp I                &kp O                &kp P                &none

/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                               +--------------------+--------------------+--------------------+        +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   | L: SYM             | A                  | S                  | D                  | F              *** | G                  |                               | LEFT               | ???                | RIGHT              |        | H                  | J              *** | K                  | L                  | ; :                | L: CRO             |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                               +--------------------+--------------------+--------------------+        +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &none                &kp A                &kp S                &kp D                &kp F                &kp G                                                &kp LEFT             &kp ENTER            &kp RIGHT                     &kp H                &kp J                &kp K                &kp L                &kp SEMI             &none

/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+      +--------------------+                        +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   | L: FUN             | Z                  | X                  | C                  | V                  | B                  |      | VOLUME / MUTE      |                        | DOWN               |                             | N                  | M                  | , '                | . "                | / ?                | L: LED             |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+      +--------------------+                        +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &none                &kp Z                &kp X                &kp C                &kp V                &kp B                       &kp C_MUTE                                    &kp DOWN                                           &kp N                &kp M                &kp COMMA            &kp DOT              &kp FSLH             &none

/*                                                                +--------------------+--------------------+--------------------+                                                                                                       +--------------------+--------------------+--------------------+
                                                                  | ESC                | L: NAS             | L: NUM             |                                                                                                       | SHIFT              | SPACE              | ENTER              |
                                                                  +--------------------+--------------------+--------------------+                                                                                                       +--------------------+--------------------+--------------------+  */
                                                                   &kp ESC              &mo 1                &mo 2                                                                                                                        &kp LSHFT            &kp SPACE            &kp ENTER
            >;

            sensor-bindings = <&inc_dec_kp C_VOLUME_UP C_VOLUME_DOWN>;
        };



  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //  L2: NAS - Navigation Layer (with Sticky Mods)
  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        lower_layer {
            display-name = "NAS";
            bindings = <
/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                                                    +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   |                    |                    | MEH (sk)           | HYPER (sk)         | RALT / Compose     |                    |                                                    | PAGE UP            |                             | HOME               | PAGE DOWN          | PAGE UP            | END                | PRINT SCREEN       | [L: APP]           |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                                                    +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &trans               &none                &sk LA(LS(LCTL))     &sk LG(LA(LS(LCTL))) &kp RALT             &none                                                                     &kp PG_UP                                          &kp HOME             &kp PG_DN            &kp PG_UP            &kp END              &kp PSCRN            &trans

/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                               +--------------------+--------------------+--------------------+        +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   | [L: SYM]           | GUI (sk)           | ALT (sk)           | CTRL (sk)          | SHIFT (sk)     *** |                    |                               | LEFT               | ???                | RIGHT              |        | LEFT               | DOWN           *** | UP                 | RIGHT              | REPEAT             | LOCK LAYER         |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+                               +--------------------+--------------------+--------------------+        +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &trans               &sk LGUI             &sk LALT             &sk LCTRL            &sk LSHIFT           &none                                                &kp HOME             &mkp LCLK            &kp END                       &kp LEFT             &kp DOWN             &kp UP               &kp RIGHT            &key_repeat          &llock_1

/* +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+      +--------------------+                        +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
   | [L: FUN]           |                    |                    |                    |                    |                    |      | VOLUME / MUTE      |                        | DOWN               |                             | N                  | M                  | , '                | . "                | / ?                | [L: LED]           |
   +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+      +--------------------+                        +--------------------+                             +--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+  */
    &none                &none                &none                &none                &none                &none                       &kp C_MUTE                                    &kp PG_DN                                          &kp N                &kp M                &kp COMMA            &kp DOT              &kp FSLH             &trans


/*                                                                +--------------------+--------------------+--------------------+                                                                                                       +--------------------+--------------------+--------------------+
                                                                  | [ESC]              | XXXXXXXX           | [L: NUM]           |                                                                                                       | DELETE             | TAB                | BACK SPACE         |
                                                                  +--------------------+--------------------+--------------------+                                                                                                       +--------------------+--------------------+--------------------+  */
                                                                   &trans               &trans               &trans                                                                                                                       &kp DEL              &kp TAB              &kp BSPC
            >;

            sensor-bindings = <&inc_dec_kp C_VOLUME_UP C_VOLUME_DOWN>;
        };


        raise_layer {
            display-name = "NUM";
            bindings = <
&trans  &kp EXCL      &kp AT        &kp HASH   &kp DLLR   &kp PRCNT                       &trans            &kp CARET  &kp AMPS   &kp ASTRK  &kp LPAR  &kp RPAR  &kp BSPC
&trans  &bt BT_CLR    &mkp LCLK     &mkp MCLK  &mkp RCLK  &mkp MB4                &trans  &mkp LCLK  &trans &kp MINUS  &kp EQUAL  &kp LBKT   &kp RBKT  &kp BSLH  &kp GRAVE
&trans  &out OUT_USB  &out OUT_BLE  &none      &none      &mkp MB5  &kp C_MUTE            &trans            &kp UNDER  &kp PLUS   &kp LBRC   &kp RBRC  &kp PIPE  &kp TILDE
                                    &trans     &trans     &kp SPACE                                         &kp RET    &trans     &trans
            >;

            sensor-bindings = <&inc_dec_kp PG_UP PG_DN>;
        };

        layer_3 {
            display-name = "Fn";
            bindings = <
&trans  &kp F1      &kp F2      &kp F3       &kp F4     &kp F5                         &trans            &kp F6       &kp F7     &kp F8       &kp F9      &kp F10          &kp F11
&trans  &trans      &mkp LCLK   &mkp MCLK    &mkp RCLK  &mkp MB4               &trans  &mkp LCLK  &trans &bootloader  &mkp LCLK  &mkp MCLK    &mkp RCLK   &kp PRINTSCREEN  &kp F12
&trans  &sys_reset  &trans      &bootloader  &trans     &mkp MB5 &kp C_MUTE            &trans            &trans       &trans     &bootloader  &sys_reset  &kp SCROLLLOCK   &kp PAUSE_BREAK
                                &trans      &trans      &trans                                           &trans       &trans     &trans
            >;

            sensor-bindings = <&rgb_encoder>;
        };
    };
};
